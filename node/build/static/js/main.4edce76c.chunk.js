(window.webpackJsonpchat_react=window.webpackJsonpchat_react||[]).push([[0],{119:function(e,t){},122:function(e,t,n){},123:function(e,t,n){},124:function(e,t,n){},129:function(e,t){!function(e,t){var n,a=e.document,r=a.documentElement,s=a.querySelector('meta[name="viewport"]'),c=a.querySelector('meta[name="flexible"]'),i=0,o=0,l=t.flexible||(t.flexible={});if(s){console.warn("\u5c06\u6839\u636e\u5df2\u6709\u7684meta\u6807\u7b7e\u6765\u8bbe\u7f6e\u7f29\u653e\u6bd4\u4f8b");var u=s.getAttribute("content").match(/initial\-scale=([\d\.]+)/);u&&(o=parseFloat(u[1]),i=parseInt(1/o,10))}else if(c){var m=c.getAttribute("content");if(m){var p=m.match(/initial\-dpr=([\d\.]+)/),h=m.match(/maximum\-dpr=([\d\.]+)/);p&&(i=parseFloat(p[1]),o=parseFloat((1/i).toFixed(2))),h&&(i=parseFloat(h[1]),o=parseFloat((1/i).toFixed(2)))}}if(!i&&!o){var f=e.devicePixelRatio;o=1/(i=f>=3&&(!i||i>=3)?3:f>=2&&(!i||i>=2)?2:1)}if(r.setAttribute("data-dpr",i),!s)if((s=a.createElement("meta")).setAttribute("name","viewport"),s.setAttribute("content","initial-scale="+o+", maximum-scale="+o+", minimum-scale="+o+", user-scalable=no"),r.firstElementChild)r.firstElementChild.appendChild(s);else{var d=a.createElement("div");d.appendChild(s),a.write(d.innerHTML)}function g(){var t=r.getBoundingClientRect().width;t/i>750&&(t=750*i);var n=t/10;r.style.fontSize=n+"px",l.rem=e.rem=n}e.addEventListener("resize",function(){clearTimeout(n),n=setTimeout(g,300)},!1),e.addEventListener("pageshow",function(e){e.persisted&&(clearTimeout(n),n=setTimeout(g,300))},!1),"complete"===a.readyState?a.body.style.fontSize=12*i+"px":a.addEventListener("DOMContentLoaded",function(e){a.body.style.fontSize=12*i+"px"},!1),g(),l.dpr=e.dpr=i,l.refreshRem=g,l.rem2px=function(e){var t=parseFloat(e)*this.rem;return"string"===typeof e&&e.match(/rem$/)&&(t+="px"),t},l.px2rem=function(e){var t=parseFloat(e)/this.rem;return"string"===typeof e&&e.match(/px$/)&&(t+="rem"),t}}(window,window.lib||(window.lib={}))},130:function(e,t,n){},131:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(57),c=n.n(s),i=n(30),o=n(63),l=n(6),u=n(7),m=n(9),p=n(8),h=n(10),f=n(12),d=n(18),g=n(61);function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}var b=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"\u6478\u9c7c\u4ff1\u4e50\u90e8";document.title=e},w=function(e,t){var n,a={"M+":(t=(n=t,Object.prototype.toString.call(n)).includes("Date")?t:new Date(t)).getMonth()+1,"d+":t.getDate(),"h+":t.getHours()%12===0?12:t.getHours()%12,"H+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds(),"q+":Math.floor((t.getMonth()+3)/3),S:t.getMilliseconds()};for(var r in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length))),/(E+)/.test(e)&&(e=e.replace(RegExp.$1,(RegExp.$1.length>1?RegExp.$1.length>2?"\u661f\u671f":"\u5468":"")+["\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d","\u65e5"][t.getDay()+""])),a)new RegExp("("+r+")").test(e)&&(e=e.replace(RegExp.$1,1===RegExp.$1.length?a[r]:("00"+a[r]).substr((""+a[r]).length)));return e},E=function(){return document.cookie.split(";").reduce(function(e,t){var n=t.split("="),a=Object(g.a)(n,2),r=a[0],s=a[1];return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(n,!0).forEach(function(t){Object(d.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},e,Object(d.a)({},r,s))},{})},O=function(e){return E()[e]},y=n(5),j=n.n(y),_=n(13);n(70);function x(e){var t=e.isShow,n=e.title,a=void 0===n?"\u63d0\u793a":n,s=e.description,c=void 0===s?"":s,i=e.confirmText,o=void 0===i?"\u597d\u7684\u5427":i,l=e.cancelText,u=void 0===l?"\u7b97\u4e86":l,m=e.onConfirm,p=e.onCancel,h=void 0===p?null:p;return r.a.createElement(r.a.Fragment,null,t?r.a.createElement("div",{className:"alert-cover"},r.a.createElement("div",{className:"alert"},r.a.createElement("div",{className:"alert__heading"},a),r.a.createElement("div",{className:"alert__description"},c),r.a.createElement("div",{className:"alert__buttons"},h&&r.a.createElement("button",{className:"alert__buttons_cancel",onClick:h},u),r.a.createElement("button",{className:"alert__buttons_confirm",onClick:m},o)))):null)}var N=n(31),k=n.n(N),C="api/login",S="/api/getMsgList",M=function(){var e=Object(_.a)(j.a.mark(function e(t){var n,a;return j.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.a.post(C,t);case 2:return n=e.sent,a=n.data,e.abrupt("return",a);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),P=function(){var e=Object(_.a)(j.a.mark(function e(t){var n,a;return j.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.a.get(S,t);case 2:return n=e.sent,a=n.data,e.abrupt("return",a);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}();n(87);function D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?D(n,!0).forEach(function(t){Object(d.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var L=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(m.a)(this,Object(p.a)(t).call(this,e))).handleChangeUsername=function(e){var t=e.target.value.replace(/\s+/,"");n.setState({username:t})},n.handleChangePawsword=function(e){var t=e.target.value;n.setState({password:t})},n.handleClickSubmitUserData=Object(_.a)(j.a.mark(function e(){var t,a,r,s;return j.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.state,a=t.username,r=t.password,a){e.next=3;break}return e.abrupt("return",n.showAlert("\u8bf7\u8f93\u5165\u6478\u9c7c\u8005\u5927\u540d\uff01"));case 3:if(r){e.next=5;break}return e.abrupt("return",n.showAlert("\u8bf7\u8f93\u5165\u6478\u9c7c\u53e3\u4ee4\uff01"));case 5:if(!(a.length<2)){e.next=7;break}return e.abrupt("return",n.showAlert("\u884c\u8d70\u6c5f\u6e56\u540d\u53f7\u600e\u53ef\u5c11\u4e8e\u4e24\u4e2a\u5b57\uff01"));case 7:if(!(a.length>8)){e.next=9;break}return e.abrupt("return",n.showAlert("\u6478\u9c7c\u4eba\u7684\u5927\u540d\u518d\u5927\u4e5f\u5927\u4e0d\u8fc7\u516b\u4e2a\u5b57\uff01"));case 9:if(!(r.length<6)){e.next=11;break}return e.abrupt("return",n.showAlert("\u53e3\u4ee4\u592a\u77ed\uff0c\u9601\u4e0b\u8bf7\u91cd\u65b0\u8f93\u8fc7\uff01"));case 11:if(!(r.length>16)){e.next=13;break}return e.abrupt("return",n.showAlert("\u53e3\u4ee4\u8fd9\u4e48\u957f\uff0c\u6211\u90fd\u8bb0\u4e0d\u8fc7\u6765\uff01"));case 13:return e.next=15,M({username:a,password:r});case 15:if(1===(s=e.sent).status){e.next=18;break}return e.abrupt("return",n.showAlert(s.message));case 18:n.props.history.replace(n.state.from);case 19:case"end":return e.stop()}},e)})),n.onAlertConfirm=function(){n.setState(function(e){return{AlertProps:A({},e.AlertProps,{isShow:!1,description:""})}})},n.state={username:"",password:"",AlertProps:{isShow:!1,title:"\u63d0\u793a",description:"",onConfirm:n.onAlertConfirm},from:n.props.location.state.from||{pathname:"/"}},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"showAlert",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"\u63d0\u793a";this.setState(function(n){return{AlertProps:A({},n.AlertProps,{isShow:!0,title:t,description:e})}})}},{key:"render",value:function(){return r.a.createElement("div",{className:"login"},r.a.createElement("img",{className:"login__sologan",src:"./sologan.svg",alt:"\u6b66\u9675\u4eba\u6478\u9c7c\u4e3a\u4e1a"}),r.a.createElement("div",{className:"login__input"},r.a.createElement("label",{htmlFor:"username",className:"login__input_label"},"\u6478\u9c7c\u4eba\uff1a"),r.a.createElement("input",{type:"text",id:"username",placeholder:"\u8bf7\u8f93\u5165\u6635\u79f0",value:this.state.username,onChange:this.handleChangeUsername})),r.a.createElement("div",{className:"login__input"},r.a.createElement("label",{htmlFor:"password",className:"login__input_label"},"\u6478\u9c7c\u53e3\u4ee4\uff1a"),r.a.createElement("input",{id:"password",type:"password",placeholder:"\u8bf7\u8f93\u5165\u5bc6\u7801",value:this.state.password,onChange:this.handleChangePawsword})),r.a.createElement("div",{className:"login__submit"},r.a.createElement("input",{value:"\u8fdb \u5165",type:"button",onClick:this.handleClickSubmitUserData})),r.a.createElement(x,this.state.AlertProps))}}]),t}(r.a.Component),R=n(62),T=(n(88),function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(m.a)(this,Object(p.a)(t).call(this,e))).formatMillisecond=function(e){var t=Date.now()-(e=new Date(e).valueOf());return t<6e4?"".concat(parseInt(t/1e3,10),"\u79d2\u524d"):t<36e5?"".concat(parseInt(t/6e4,10),"\u5206\u524d"):t<432e5?"".concat(parseInt(t/36e5,10),"\u5c0f\u65f6\u524d"):t<2592e6?"".concat(Math.round(t/864e5),"\u5929\u524d"):w("M\u6708d\u65e5EE HH:mm:ss",e)},n.state={formatedTime:"0\u79d2\u524d"},n.timer=null,n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.setState({formatedTime:this.formatMillisecond(this.props.time)}),this.timer=setInterval(function(){e.setState({formatedTime:e.formatMillisecond(e.props.time)})},6e4)}},{key:"componentWillUnmount",value:function(){this.timer&&clearInterval(this.timer)}},{key:"render",value:function(){return r.a.createElement("div",{className:"message_time"},r.a.createElement("p",null,this.state.formatedTime))}}]),t}(r.a.Component)),F=(n(89),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=e.match(/[\u4e00-\u9fa5]/g);if(t&&t.length){var n=e.length;return e.slice(n-2)}return e.slice(0,4)});function U(e){var t=e.isSelf,n=e.username,a=e.content;return r.a.createElement("div",{className:"message ".concat(t?"right":"left","_message")},r.a.createElement("div",{className:"user"},r.a.createElement("span",{className:"user_icon"},F(n))),r.a.createElement("div",{className:"speech"},r.a.createElement("div",{className:"username"},n),r.a.createElement("div",{className:"content"},a)))}function $(e){var t=e.isShowTime,n=e.time,a=e.content,s=e.username,c=e.isSelf,i=void 0!==c&&c;return r.a.createElement("div",{className:"message_wrap"},t&&r.a.createElement(T,{time:n}),r.a.createElement(U,{isSelf:i,username:s,content:a}))}n(90);function H(e){var t=e.heading,n=e.count;return r.a.createElement("div",{className:"chat__heading"},t,"(",n,")")}var I=n(58),W=n.n(I),z=(n(122),function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(m.a)(this,Object(p.a)(t).call(this,e))).handleKeyUpMessage=function(e){e.ctrlKey&&13===e.keyCode&&n.handleClickSendMessage()},n.handleClickSendMessage=function(){n.props.onsendMsg(n.state.message),n.setState({message:""})},n.handleChangeMessage=function(e){n.setState({message:e.target.value})},n.state={message:""},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"chat__input"},r.a.createElement("textarea",{className:"chat__input_white",value:this.state.message,onChange:this.handleChangeMessage,onKeyUp:this.handleKeyUpMessage}),r.a.createElement("button",{className:"chat__input_btn",onClick:this.handleClickSendMessage},"\u53d1\u9001"))}}]),t}(a.Component)),K=(n(123),function(e){var t=e.content;return r.a.createElement("div",{className:"notice_wrap"},t)}),q=(n(124),function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(m.a)(this,Object(p.a)(t).call(this,e))).renderMessageList=function(e,t){return e.map(function(e,n){var a=e._id,s=e.time,c=e.username,i=e.content;return"notice"===e.event?r.a.createElement(K,{key:a,content:i}):r.a.createElement($,{key:a,time:s,content:i,username:c,isShowTime:n%4===0,isSelf:c===t})})},n.appendChatList=function(e){n.setState(function(t){return{msgList:[].concat(Object(R.a)(t.msgList),[e])}},function(){n.sliderDownNews()})},n.sendMsgMethod=function(e){var t=n.state,a=t.chatName,r=t.ownUserName;n.state.socket.emit("chat",{content:e,chatName:a,username:r})},n.sliderDownNews=function(){n.chatWrapRef.current.scrollTop=n.chatWrapRef.current.offsetHeight},n.state={msgList:[],ownUserName:decodeURI(O("username")),chatName:"\u6478\u9c7c\u4ff1\u4e50\u90e8",socket:null,memberCount:0},n.chatWrapRef=r.a.createRef(),n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=Object(_.a)(j.a.mark(function e(){var t,n,a,r,s,c=this;return j.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=this.state.chatName,e.next=4,P({chatName:t});case 4:1===(n=e.sent).status&&(a=n.data,r=a.msgList,s=a.chatName,this.setState({msgList:r,chatName:s,socket:W()("ws://localhost:8080")},function(){var e=c.state,t=e.ownUserName,n=(e.chatName,c.state.socket);n.on("connect",function(){n.emit("init",t)}).on("notice",function(e){var t=e.memberCount,n=e.message;c.appendChatList(n),c.setState({memberCount:t})}).on("news",c.appendChatList),c.sliderDownNews()})),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.error(e.t0);case 11:case"end":return e.stop()}},e,this,[[0,8]])}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.ownUserName,n=e.chatName,a=e.msgList,s=e.memberCount;return r.a.createElement("div",{className:"chat"},r.a.createElement(H,{heading:n,count:s}),r.a.createElement("div",{className:"chat__content",ref:this.chatWrapRef},this.renderMessageList(a,t)),r.a.createElement(z,{onsendMsg:this.sendMsgMethod}))}}]),t}(r.a.Component)),B=function(e){function t(){return Object(l.a)(this,t),Object(m.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.a.createElement(f.d,null,r.a.createElement(f.b,{exact:!0,path:"/login",component:L}),r.a.createElement(J,{path:"/"},r.a.createElement(q,null)))}}]),t}(r.a.Component);function J(e){var t=e.children,n=Object(o.a)(e,["children"]);return r.a.createElement(f.b,Object.assign({},n,{render:function(e){var n=e.location;return O("username")?t:r.a.createElement(f.a,{to:{pathname:"/login",state:{from:n}}})}}))}n(129),n(130);c.a.render(r.a.createElement(function(){return b(),r.a.createElement(i.a,null,r.a.createElement(B,null))},null),document.getElementById("root"))},64:function(e,t,n){e.exports=n(131)},70:function(e,t,n){},87:function(e,t,n){},88:function(e,t,n){},89:function(e,t,n){},90:function(e,t,n){}},[[64,1,2]]]);
//# sourceMappingURL=main.4edce76c.chunk.js.map